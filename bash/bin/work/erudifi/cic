#! /bin/bash

source "${_SCRIPTS_PATH}/_paths"
source "${_SCRIPTS_PATH}/_helpers"

[[ "$_DEBUG" == "true" ]] && set -x

#------------------------------------------------------------------------#
# CIC specific alias
#------------------------------------------------------------------------#

readonly work_path="$( extract_value_assoc "${_PATHS}" "work" )"
readonly cic_path="${work_path}/cic-loantape"

function main() {
    [[ $# -eq 0 ]] && { change_dir; return; }

    local options=$(
        getopt -o xdX --long start,dump,stop -- "$@"
    )

    [[ $? -ne 0 ]] && {
        echo "Incorrect options provided"
        exit 1
    }

    eval set -- "${options}"

    while [[ $# -gt 0 ]]; do
        case "$1" in
            -x | --start) docker_start; break ;;
            -d | --dump) docker_dump; break ;;
            -X | --stop) docker_stop; break ;;
            --) shift; break ;;
            *) usage; break ;;
        esac
    done
}


function change_dir() {
    gnome-terminal --working-directory="${cic_path}" --no-environment --tab
    gnome-terminal --working-directory="${cic_path}" --no-environment --tab
}


function docker_start() { docker-compose up; }
function docker_dump() { docker-compose exec web flask makedump; }
function docker_stop() { docker-compose down; }
function usage() { echo; echo "CIC specific alias"; }

alias cic="cd Documents/Work/cic-loantape"
alias cic_up="docker-compose up"
alias cic_dump="docker-compose exec web flask makedump"

main "$@"

[[ "$_DEBUG" == "true" ]] && set +x
