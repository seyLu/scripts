#! /bin/bash

shopt -s expand_aliases
source "${_SCRIPTS_PATH}/__init__"

[[ "$_DEBUG" == "true" ]] && set -x

#------------------------------------------------------------------------#
# Moves compiled markdown into root directory and rename to README.md
# Input:
#   compiled.md
# Output:
#   ../README.md
#------------------------------------------------------------------------#

# Generate Readme
function main() {
    if [[ $# -eq 1 && "$1" == "init" ]]; then
        if [[ ! -d markdown ]]; then
            mkdir markdown
            cd markdown || return
        fi

        init
    elif [[ -f main.md ]]; then
        generate_readme
    elif [[ -d markdown ]]; then
        printf '%s\n' "dir: markdown/ found"

        if [[ -f markdown/main.md ]]; then
            cd markdown || return
            printf '%s\n' "file: markdown/main.md found"

            generate_readme
        else
            printf '%s\n' "file: markdown/main.md not found"
            init
        fi
    else
        printf '%s\n' "usage: type \`readme init\` to initialize a markdown directory"
    fi
}

# Generate Readme
function generate_readme() {
    mdcompile

    if [[ -f compiled.md ]]; then
        mv compiled.md ../README.md

        log::success "compiled markdown and generated README"
    else
        log::error "compiling failed"
    fi

    cd || return
}

# Initialize markdown dir
function init() {
    printf '%s\n' "Initializing markdown directory..."

    touch markdown/main.md
    mkdir markdown/sections

    printf '%s\n' "Done"
}

main "$@"

[[ "$_DEBUG" == "true" ]] && set +x
